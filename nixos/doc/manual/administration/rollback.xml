<section xmlns="http://docbook.org/ns/docbook"
        xmlns:xlink="http://www.w3.org/1999/xlink"
        xmlns:xi="http://www.w3.org/2001/XInclude"
        version="5.0"
        xml:id="sec-rollback">
 <title>Rolling Back Configuration Changes</title>

 <para>
  After running <command>nixos-rebuild</command> to switch to a new
  configuration, you may find that the new configuration doesn’t work very
  well. In that case, there are several ways to return to a previous
  configuration.
 </para>

 <para>
  First, the GRUB boot manager allows you to boot into any previous
  configuration that hasn’t been garbage-collected. These configurations can
  be found under the GRUB submenu “NixOS - All configurations”. This is
  especially useful if the new configuration fails to boot. After the system
  has booted, you can make the selected configuration the default for
  subsequent boots:
<screen>
<prompt># </prompt>/run/current-system/bin/switch-to-configuration boot</screen>
 </para>

 <para>
  Second, you can switch to the previous configuration in a running system:
<screen>
<prompt># </prompt>nixos-rebuild switch --rollback</screen>
  This is equivalent to running:
<screen>
<prompt># </prompt>/nix/var/nix/profiles/system-<replaceable>N</replaceable>-link/bin/switch-to-configuration switch</screen>
  where <replaceable>N</replaceable> is the number of the previous NixOS generation.
 </para>

 <para>
  Third, you can switch to a specific configuration in a running system:
  <screen>
   <prompt># </prompt>nixos-rebuild switch --generation <replaceable>N</replaceable></screen>
  This is equivalent to running:
  <screen>
   <prompt># </prompt>/nix/var/nix/profiles/system-<replaceable>N</replaceable>-link/bin/switch-to-configuration switch</screen>
  where <replaceable>N</replaceable> is the number of the NixOS generation you
  want to switch to.
  To get a list of available generations, you can run
  <screen>
   <prompt># </prompt>nixos-rebuild list-generations
   Generation  NixOS version           Kernel  Build-date
   <replaceable>...</replaceable>
   99          21.03.20210103.44ac7cb  5.9.9   Sun 2021-01-03 21:00:00
   100         21.03.20210104.19ab7f1  5.10.4  Mon 2021-01-04 20:21:22  (current)</screen>
 </para>
</section>
